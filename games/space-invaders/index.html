<!DOCTYPE html> <html lang="zh-TW"> <head> <meta charset="UTF-8"> <title>太空入侵者 - 優化版</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <style> body { margin: 0; overflow: hidden; background: black; font-family: Arial, sans-serif; color: white; } #gameContainer { position: relative; width: 600px; margin: 0 auto; } #gameCanvas { display: block; background: black; border: 2px solid white; } #info { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; font-size: 22px; width: 100%; } #info span { text-align: left; white-space: nowrap; } #score { width: 130px; } #bestScore { width: 210px; } #level { display: flex; justify-content: center; align-items: center; width: 80px; } #lives { width: 180px; display: flex; justify-content: center; align-items: center; } #lives img { vertical-align: middle; margin-left: 5px; } .controls { display: flex; justify-content: space-between; width: 100%; } .movement-controls { display: flex; gap: 5px; } .controlButton { background-color: #333; border: 1px solid #fff; color: #fff; font-size: 20px; padding: 30px 20px; margin: 8px 0; border-radius: 5px; width: 160px; } .controlButton:active { background-color: #555; } </style> </head> <body> <div id="gameContainer"> <div id="info"> <span id="bestScore">最高分數：0</span> <span id="score">分數：0</span> <span id="level">第 1 關</span> <span id="lives">生命：</span> </div> <canvas id="gameCanvas" width="600" height="600"></canvas> <div class="controls"> <div class="movement-controls"> <button class="controlButton" id="btnLeft">左移</button> <button class="controlButton" id="btnRight">右移</button> </div> <button class="controlButton" id="btnFire">發射子彈</button> </div> </div> <!-- 音效檔案 --> <audio id="bgMusicStart" src="bg_music_start.mp3" loop></audio> <audio id="bgMusicGame" src="bg_music_game.mp3" loop></audio> <audio id="explosionSound" src="explosion.mp3"></audio> <audio id="hitSound" src="hit.mp3"></audio>
<audio id="shootSound" src="shoot.mp3"></audio> <script> // ================= 全域變數與狀態 ================= const canvas = document.getElementById('gameCanvas'); const ctx = canvas.getContext('2d'); // 資訊顯示區 const scoreDisplay = document.getElementById('score'); const bestScoreDisplay = document.getElementById('bestScore'); const levelDisplay = document.getElementById('level'); const livesDisplay = document.getElementById('lives'); /* 遊戲狀態： "start" ：開始畫面（顯示操作說明） "playing" ：遊戲進行中 "levelTransition": 關卡過渡，暫停 2 秒後進入下一關 "victoryWait" ：完成第 10 關後先顯示「成功爆機」3秒 "victory" ：勝利畫面，等待玩家返回開始畫面（點擊Canvas返回也有效） "gameOverWait" ：遊戲失敗時先顯示「Game Over」，等待 2 秒 "gameOver" ：遊戲失敗狀態，等待玩家返回開始畫面（點擊Canvas返回也有效） */ let gameState = "start"; let score = 0; let bestScore = parseInt(localStorage.getItem("bestScore")) || 0; let level = 1; const maxLevel = 10; // ================= 背景星空 ================= let stars = []; const starCount = 100; function initStars() { stars = []; for (let i = 0; i < starCount; i++) { stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, radius: Math.random() * 1.5 + 0.5, speed: Math.random() * 0.5 + 0.2 }); } } function updateStars() { for (let star of stars) { star.y += star.speed; if (star.y > canvas.height) { star.y = 0; star.x = Math.random() * canvas.width; } } } function drawStars() { ctx.fillStyle = "white"; for (let star of stars) { ctx.beginPath(); ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2); ctx.fill(); } } initStars(); // ================= 爆炸效果 ================= let explosions = []; function addExplosion(x, y) { explosions.push({ x: x, y: y, radius: 0, maxRadius: 30, alpha: 1, expansionRate: 1.5, fadeRate: 0.03, color: 'orange' }); const explosionSound = document.getElementById('explosionSound'); explosionSound.currentTime = 0; explosionSound.play(); } function updateExplosions() { for (let i = explosions.length - 1; i >= 0; i--) { let exp = explosions[i]; exp.radius += exp.expansionRate; exp.alpha -= exp.fadeRate; if (exp.alpha <= 0) { explosions.splice(i, 1); } } } function drawExplosions() { for (let exp of explosions) { ctx.save(); ctx.globalAlpha = exp.alpha; ctx.fillStyle = exp.color; ctx.beginPath(); ctx.arc(exp.x, exp.y, exp.radius, 0, Math.PI * 2); ctx.fill(); ctx.restore(); } }   // ================= 圖片資源管理 =================
  const images = {};
  const imageSources = {
    title: 'title.png',
    player: 'player.png',
    invader: 'invader.png',
    ufo1: 'ufo1.png',
    ufo2: 'ufo2.png'
  };
  let imagesLoaded = 0;
  const totalImages = Object.keys(imageSources).length;

  function loadImages(callback) {
    for (let key in imageSources) {
      images[key] = new Image();
      images[key].onload = function() {
        imagesLoaded++;
        if (imagesLoaded === totalImages) {
          callback();
        }
      };
      images[key].onerror = function() {
        console.error("Failed to load image: " + imageSources[key]);
        imagesLoaded++;
        if (imagesLoaded === totalImages) {
          callback();
        }
      }
      images[key].src = imageSources[key];
    }
  }

  // ================= 圖片資源 (Legacy references for compatibility) =================
  let titleImage, playerImage, invaderImage, ufoImage1, ufoImage2;

  // ================= 啟動遊戲 (強制執行一次 draw，避免圖片加載失敗導致黑屏) =================
  window.addEventListener('load', function() {
      // 先嘗試繪製一次背景（至少有星空）
      initStars();
      draw(); 
      
      // 開始加載圖片
      loadImages(function() {
        titleImage = images['title'];
        playerImage = images['player'];
        invaderImage = images['invader'];
        ufoImage1 = images['ufo1'];
        ufoImage2 = images['ufo2'];
        
        draw(); // 圖片加載完後再畫一次
        requestAnimationFrame(gameLoop);
      });
  });
 </script> </body> </html>